<!--

    CollateX - a Java library for collating textual sources,
    for example, to produce an apparatus.

    Copyright (C) 2010 ESF COST Action "Interedition".

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.

-->

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<title>How-To: CollateX with a PHP-client</title>
</head>
<body>
<h1>Demonstration of CollateX REST-Service and PHP-client</h1>
<h2>About</h2>
<p><i>CollateX</i> is a Java software for collating textual sources, for example, to produce a critical apparatus. As the designated successor of <a href="http://www.sd-editions.com/"> Peter Robinson's <i>Collate</i></a> it is developed jointly by several partner institutions and individuals under the umbrella of the European initiative <a href="http://www.interedition.eu/">&quot;Interedition&quot;.</a></p>
<p>In this demonstration we show the interaction between a small php-client application calling a locally installed CollateX webservice. To try it you need:</p>
<ul>
	<li>PHP5x + webserver;</li>
	<li>cUrl library enabled in PHP (<a href="http://curl.haxx.se/libcurl/php/">see how to</a>);</li>
	<li>Tomcat 6;</li>
	<li>Java Sun JDK 6/ Java OpenJDK;</li>
	<li>Optional JSON-viewer plugin for your browser (check <a href="https://addons.mozilla.org/en-US/firefox/addon/10869/">Ben Hollis' JSONView for Firefox</a></li>
</ul>
<h2>Collate- webservice</h2>
<p>Download the compiled war-file with the CollateX REST service from the Maven Repository. <a href="http://collatex.sourceforge.net/maven-repository/eu/interedition/collatex/collatex-web/0.9/">You can find it here</a></p>
<p>Unpack the collatex-web-0.9.war in your Tomcat6 webapps-directory.</p>
<p>Restart Tomcat</p>
<p>Go to http://localhost:8080/collatex-web-0.9/api/collate to confirm the CollateX webservice is running. You should find a welcome screen. If not, check the local port of your Tomcat installation and alter the url accordingly.</p>
<h2>PHP Client</h2>
<p>This small democlient uses two files: index.html and formhandler.php.</p>
<p>index.html contains a form with four text-fields where you can enter the text you want to compare. You can also set the required output (either JSON or XML). XML-TEI is set by default. <strong>Note:</strong> in this limited demonstration you need to enter text in each of the four fields. </p>
<p>The form in index.html is posted to formhandler.php. For formhandler.php to work you need the cUrl-library installed in PHP.</p>
<pre>
	$ch = curl_init();

	$headers = array ("Content-type: application/json;charset=UTF-8;",
						"Accept: " . $_POST['output_type']);
	$content = '{
		"witnesses" : [
		        {"id" : "A", "content" : "' . $_POST['text1'] . '" }, 
		        {"id" : "B", "content" : "' . $_POST['text2'] . '" },
		        {"id" : "C", "content" : "' . $_POST['text3'] . '" },
		        {"id" : "D", "content" : "' . $_POST['text4'] . '" }
		        ]
	}';
	
	curl_setopt($ch, CURLOPT_URL,"http://localhost:8080/collatex-web-0.9/api/collate");
	curl_setopt($ch, CURLOPT_POST, 1);
	curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
	curl_setopt($ch, CURLOPT_HTTPHEADER, $headers);
	curl_setopt($ch, CURLOPT_POSTFIELDS, $content);
	$response = curl_exec ($ch);

	header("Content-type: " . $_POST['output_type']);
	echo $response; 
</pre>
<p>With cUrl you make a HTTP-POST request to the CollateX REST service.</p>
<p>Configure the header of the HTTP-POST request:</p>
<ul>
	<li>'Content-type: application/json;charset=UTF-8;'</li>
	<li>'Accept: application/xml' OR 'Accept: application/json' (select the output of your choice)</li>
</ul>
<p>The body of the HTTP-POST request must contain a valid JSON-string. Like:</p>
<pre bgcolor="gray">
{
	"witnesses" : [
	        {"id" : "A", "content" : "A black cat in a black basket" }, 
	        {"id" : "B", "content" : "A black cat in a black basket" },
	        {"id" : "C", "content" : "A striped cat in a black basket" },
	        {"id" : "D", "content" : "A striped cat in a white basket" }
	        ]
}
</pre>
<p>The root object in the body must contain a property 'witnesses', which contains a list of 'witness' objects in turn. Each witness object has to contain a unique identifier in the property id. Besides, the object can either contain the textual content of the witness as a string property named content (as shown above).</p> 
<p>Configure the cUrl options in PHP:</p>
<ul>
	<li>'CURLOPT_URL' contains the url to the CollateX webservice</li>
	<li>'CURLOPT_POST', true specifies the HTTP-POST request.</li>
	<li>'CURLOPT_RETURNTRANSFER', true specifies that the webservice response should be handed back.</li>
	<li>'CURLOPT_HTTPHEADER', contains the HTTP-POST headers</li>
	<li>'CURLOPT_POSTFIELDS', contains the HTTP-POST body</li>
</ul>
<p>The response of the webservice is put into $response. For it to be echoed succesfully to the browser a content-type must be set for the page. The proper content-type depends on the type of data the REST Service returned (application/xml is the default choice in this example). To properly view a JSON response you need a JSON viewer plugin installed in your browser.</p>
<h2>Partners</h2>
<ul>
    <li><a href="http://www.huygensinstituut.knaw.nl/">Huygens Instituut</a></li>
    <li><a href="http://www.digital-humanities.de/">Universität Würzburg</a></li>
    <li><a href="http://www.ox.ac.uk/">Oxford University</a></li>
	<li><a href="http://www.itsee.bham.ac.uk/">Univ. of Birmingham</a></li>
</ul>
</body>
</html>